<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ApnaParivar - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css" />
        <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>

    <div class="sidebar">
        <div class="logo">ApnaParivar</div>
        <nav>
            <a href="dashboard.html" class="nav-link active">üè† Dashboard</a>
            <a href="#tree" class="nav-link">üå≥ Tree View</a>
            <a href="admin_panel.html" class="nav-link">‚öô Admin Panel</a>
            <a href="payment.html" class="nav-link">üí≥ Subscription</a>
        </nav>
        <hr class="sidebar-divider">
        <p class="sidebar-footer">&nbsp;</p>
    </div>

    <div class="main-content">

        <header class="site-header">
            <div class="header-inner">
                <h1 class="brand">ApnaParivar</h1>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboard">
                        <div class="header">
                                <h1 id="welcomeName">Welcome!</h1>
                                <div>
                                    <button class="btn-primary" id="addMemberBtn" disabled>‚ûï Add New Member</button>
                                    <button class="btn-ghost" id="manageAdminsBtn" style="display:none;">Manage Admins</button>
                                </div>
                        </div>

                                    <div id="familiesSection" class="card" style="margin-bottom:16px;">
                                        <h3>Your Families</h3>
                                        <label for="familySelect" class="sr-only">Select family</label>
                                        <select id="familySelect" class="select-input" aria-label="Select family">
                                            <option value="">-- Select a family --</option>
                                        </select>
                                        <div id="families" class="families-list" aria-live="polite"></div>
                                        <div class="create-family-row">
                                            <input id="familyName" class="input-full" placeholder="Create new family (e.g., Sharma)" aria-label="New family name" />
                                            <button id="createFamilyBtn" class="btn-primary">Create Family</button>
                                        </div>
                                    </div>

                            <!-- Add Member Modal -->
                            <div id="addMemberModal" class="modal-backdrop" aria-hidden="true">
                                <div class="modal" role="dialog" aria-modal="true" aria-labelledby="addMemberTitle">
                                    <h3 id="addMemberTitle">Add Family Member</h3>
                                    <div class="card">
                                        <form id="addMemberForm">
                                        <div class="form-row">
                                            <input id="am_name" type="text" placeholder="Full name" aria-label="Full name" required />
                                            <select id="am_gender" aria-label="Gender">
                                                <option value="">Gender</option>
                                                <option value="male">Male</option>
                                                <option value="female">Female</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="form-row full-width-input">
                                            <label for="am_photo" class="label-inline">Member Photo (Optional)</label>
                                                                                        <input id="am_photo" type="file" accept="image/*" aria-label="Member Photo" />
                                                                                        <div style="margin-top:8px;">
                                                                                            <img id="am_photo_preview" src="" alt="Preview" style="display:none;width:96px;height:96px;object-fit:cover;border-radius:8px;border:1px solid #e6e9ef" />
                                                                                            <div id="am_photo_msg" style="font-size:0.85em;color:#666;margin-top:6px"></div>
                                                                                        </div>
                                        </div>
                                        <div class="form-row" style="align-items:flex-start;">
                                            <div style="flex:1;">
                                                <select id="am_relationType" aria-label="Relation type">
                                                    <option value="">Relation</option>
                                                    <option value="parent">Parent of selected</option>
                                                    <option value="child">Child of selected</option>
                                                    <option value="spouse">Spouse of selected</option>
                                                    <option value="sibling">Sibling of selected</option>
                                                    <option value="none">No relation / standalone</option>
                                                </select>
                                            </div>
                                            <div style="flex:1;">
                                                <select id="am_relationTarget" aria-label="Relation target">
                                                    <option value="">Select person (optional)</option>
                                                </select>
                                            </div>
                                            <div style="display:flex;align-items:center;gap:8px;">
                                                <button id="am_add_relation" class="btn-primary" type="button" style="padding:8px 10px;">Add</button>
                                            </div>
                                        </div>
                                        <div class="form-row" style="flex-direction:column;gap:6px;margin-bottom:12px;">
                                            <label class="label">Relations added:</label>
                                            <div id="am_relations_list" style="min-height:28px;"></div>
                                        </div>
                                        <div class="form-row">
                                            <input id="am_age" type="number" placeholder="Age" />
                                            <input id="am_relationText" placeholder="Relation (e.g., father)" />
                                        </div>
                                        <div class="modal-actions">
                                            <button id="am_cancel" class="btn-ghost">Cancel</button>
                                            <button id="am_submit" class="btn-primary">Add Member</button>
                                        </div>
                                        </form>
                                    </div>

                                                    <!-- Manage Admins Modal / Admin Panel Link -->
                                                    <div id="manageAdminsModal" class="modal-backdrop" aria-hidden="true">
                                                        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="manageAdminsTitle">
                                                            <h3 id="manageAdminsTitle">Manage Admins</h3>
                                                            <div class="card">
                                                                <div style="margin-bottom:8px;">
                                                                    <a href="admin_panel.html" class="btn-primary" style="display:inline-block;text-decoration:none;">Open Admin Panel</a>
                                                                </div>
                                                                <div id="adminsList" style="margin-bottom:8px;"></div>
                                                                <div class="form-row">
                                                                    <input id="ma_email" placeholder="Admin email to invite" />
                                                                    <button id="ma_add" class="btn-primary">Invite</button>
                                                                </div>
                                                                <div class="modal-actions">
                                                                    <button id="ma_close" class="btn-ghost">Close</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                </div>
                            </div>

            <div class="card highlight-card">
                <h2>Today in History!</h2>
                <p id="highlightText">No events for today.</p>
            </div>

            <div class="stats-grid">
                <div class="card stat-card">
                    <div class="value" id="totalMembers">-</div>
                    <div class="label">Total Members</div>
                </div>
                <div class="card stat-card">
                    <div class="value" id="latestAddition">-</div>
                    <div class="label">Latest Addition</div>
                </div>
                <div class="card stat-card">
                    <div class="value" id="nextAnniv">-</div>
                    <div class="label">Next Anniversary</div>
                </div>
            </div>
        </section>

        <!-- Tree Section -->
     <section id="tree">
    <div class="header">
        <h2>Family Tree Visualization</h2>
    </div>
    <div class="card tree-container">
        <h3>Family Tree</h3>
        <div id="d3-tree-container" style="width: 100%; height: 600px; overflow: auto;">
            <svg id="family-tree-svg"></svg>
        </div>
        <p class="hint-text">*Click any node to collapse/expand its children.</p>
    </div>
</section>

        
    </div>

    <script src="js/firebaseConfig.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/nav.js"></script>
    <script src="js/treeView.js"></script>
</body>
</html>
